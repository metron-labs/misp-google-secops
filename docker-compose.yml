services:
  forwarder:
    build: .
    image: misp-secops-forwarder:latest
    container_name: misp-secops-forwarder
    network_mode: host
    env_file:
      - .env
    environment:
      # Override these if needed, otherwise reads from .env
      - GOOGLE_SA_CREDENTIALS=/app/credentials.json
      # Toggle TEST_MODE here
      - TEST_MODE=${TEST_MODE:-false}
      - MAX_TEST_EVENTS=${MAX_TEST_EVENTS:-3}
    volumes:
      # Mount credentials file into the container
      - ./credentials.json:/app/credentials.json:ro
      # Persist state so we don't re-fetch everything on restart
      - forwarder_state:/app/data
      # Ensure config is available at the expected path
      - ./config.json:/app/config.json
    command: ["--config", "/app/config.json"]
    restart: unless-stopped

volumes:
  forwarder_state:
